# 关于mac地址的说明

## 当前的现状

1. 芯片的mac均为软件配置的，在芯片上没有mac地址寄存器, 所以都是可变的
2. Air601-12F在出厂是实际只烧录了AP的mac地址, STA和蓝牙地址是没有写入的
3. 屏蔽盖上的二维码及MAC地址是AP的mac地址

导致的问题:

1. 作为STA时, 且使用2023年12月之前编译的AT/LuatOS固件, STA地址均为默认值, 在同一个路由器下会冲突
2. 蓝牙地址, 在AT固件下是默认值, 在LuatOS固件下是设备flash相关的唯一值
3. 由于LuatOS固件对默认STA地址有防御机制, 检测到默认STA地址时, 自动切换为设备flash相关的唯一值
4. 已经丢失的MAC地址,是找不回来的, 只能通过 AT固件 重新写入

## 解决方案

AT固件:

1. 更新AT固件到最新(后面有下载地址), STA地址会与AP地址一致
2. 蓝牙地址依然会是默认地址, 但当前只能配网, 所以暂未影响, 也暂未人力解决

LuatOS固件:

1. 更新LuatOS固件到最新(后面有下载地址), STA地址会与AP地址一致
2. 蓝牙地址会根据flash的唯一值生成, 不会冲突

## 恢复/改写MAC的操作办法

1. 下载最新的AT固件, [点我下载](https://pan.air32.cn/home?path=%2F%E5%90%88%E5%AE%99%E4%BA%91%E7%9B%98%E7%9B%AE%E5%BD%95%2F%E5%90%84%E7%A7%8D%E6%B5%8B%E8%AF%95%E5%9B%BA%E4%BB%B6%2FAir601%E7%9A%84MAC%E5%9C%B0%E5%9D%80%E4%BF%AE%E6%AD%A3%E5%9B%BA%E4%BB%B6)
2. 使用LuaTools刷机, 选通用串口打印, 波特率不用管
3. 选择正确的COM, 然后点 "下载固件" 的图标
4. 选取固件, 点击 "开始"
5. 等待刷机完成, 刷机完成后, 重启设备
6. 菜单中选取"简易串口工具", 勾选回车换行. 或者关闭LuaTools, 选一款你喜欢的串口工具, 波特率115200, 8N1, 勾选回车换行
7. 假设MAC地址要设置成 12:34:56:78:90:ab
8. 设置AP的则输入  `AT+CIPAPMAC=12:34:56:78:90:ab`
9. 设置STA的则输入 `AT+CIPSTAMAC=12:34:56:78:90:ab`
10. 输入 `AT+CIPAP?` 查看当前mac地址, 如果和设置的相同, 则成功
11. 输入 `AT+CIPSTA?` 查看当前mac地址, 如果和设置的相同, 则成功

之后刷入LuatOS固件, 即可使用新的mac地址
